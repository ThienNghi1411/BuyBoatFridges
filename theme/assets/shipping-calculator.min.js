(()=>{var s=class extends HTMLElement{constructor(){super();this.url=this.dataset.url,this.form=this.querySelector(".cartPage__form"),this.country=this.querySelector("[name*=country]"),this.province=this.querySelector("[name*=province]"),this.zip=this.querySelector("[name*=zip]"),this.country.addEventListener("change",this.countryChange.bind(this)),this.form.addEventListener("submit",this.onSubmit.bind(this)),this.countryChange(),this.dataString=""}countryChange(){let e=JSON.parse(this.country.options[this.country.selectedIndex].dataset.provinces);this.province.innerHTML="",e.length&&e.forEach(a=>{let i=document.createElement("option");i.value=a[0],i.textContent=a[1],this.province.insertAdjacentElement("beforeend",i)})}onSubmit(e){this.querySelector(".cartPage__calculateShipBtn-btnText").style.display="none",this.querySelector(".cartPage__calculateShipBtn-btnTextOnSubmit").style.display="block",e.preventDefault(),this.classList.add("calculating");let a=new FormData(this.form),i=new URLSearchParams(a).toString();fetch(this.url+"?"+i).then(t=>t.json()).then(t=>{this.renderResult(t),this.querySelector(".cartPage__calculateShipBtn-btnText").style.display="block",this.querySelector(".cartPage__calculateShipBtn-btnTextOnSubmit").style.display="none"}).finally(()=>{})}renderResult(e){this.dataString=JSON.parse(this.querySelector("#dataShipping").innerText);for(let t in this.dataString)this.dataString[t]=this.dataString[t].replace("{{code}}",this.zip.value),this.dataString[t]=this.dataString[t].replace("{{province}}",this.province.value),this.dataString[t]=this.dataString[t].replace("{{country}}",this.country.value),t==="many_shipping_rates"&&e.shipping_rates&&(this.dataString[t]=this.dataString[t].replace("{{number}}",e.shipping_rates.length));let a=this.dataString.not_found_shipping_rate;e.shipping_rates&&e.shipping_rates.length>1?a=this.dataString.many_shipping_rates:e.shipping_rates&&e.shipping_rates.length==1&&(a=this.dataString.one_shipping_rate),this.querySelector(".cartPage__resCalculate-title").innerText=a;let i=document.createElement("ul");i.classList.add("cartPage__resCalculate-listRes"),e.shipping_rates&&e.shipping_rates.forEach(t=>{let n=document.createElement("li");n.classList.add("cartPage__resCalculate-listRes-option"),n.innerText=`${t.name} at $${t.price} ${t.currency}`,i.appendChild(n)}),this.querySelector(".cartPage__resCalculate-listRes").replaceWith(i)}};customElements.define("shipping-calculator",s);})();
