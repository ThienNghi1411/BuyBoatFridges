{
  "version": 3,
  "sources": ["../../app/scripts/shipping-calculator.js"],
  "sourcesContent": ["class ShippingCalculator extends HTMLElement {\r\n  constructor() {\r\n    super();\r\n\r\n    this.url = this.dataset.url;\r\n    this.form = this.querySelector('.cartPage__form');\r\n    this.country = this.querySelector('[name*=country]');\r\n    this.province = this.querySelector('[name*=province]');\r\n    this.zip = this.querySelector('[name*=zip]');\r\n  \r\n    this.country.addEventListener('change', this.countryChange.bind(this));\r\n\r\n    this.form.addEventListener('submit', this.onSubmit.bind(this));\r\n    this.countryChange();\r\n\r\n    this.dataString = \"\";\r\n\r\n  }\r\n\r\n\r\n  countryChange(){\r\n    const province = JSON.parse(this.country.options[this.country.selectedIndex].dataset.provinces);\r\n\r\n    this.province.innerHTML = '';\r\n\r\n    if(province.length){\r\n      province.forEach(item=>{\r\n        const option = document.createElement('option');\r\n        option.value = item[0];\r\n        option.textContent = item[1];\r\n        this.province.insertAdjacentElement('beforeend', option);\r\n      });\r\n\r\n      // this.province.closest('.form-field').style.display = null;\r\n    }else{\r\n      // this.province.closest('.form-field').style.display = 'none';\r\n    }\r\n  }\r\n\r\n  onSubmit(e){\r\n    this.querySelector(\".cartPage__calculateShipBtn-btnText\").style.display=\"none\";\r\n    this.querySelector(\".cartPage__calculateShipBtn-btnTextOnSubmit\").style.display=\"block\";\r\n    e.preventDefault();\r\n    this.classList.add('calculating');\r\n    let formData = new FormData(this.form);\r\n    let searchParams = new URLSearchParams(formData).toString();\r\n    fetch(this.url + '?' + searchParams).then(e=>e.json()).then(e=>{\r\n      this.renderResult(e);\r\n      this.querySelector(\".cartPage__calculateShipBtn-btnText\").style.display=\"block\";\r\n      this.querySelector(\".cartPage__calculateShipBtn-btnTextOnSubmit\").style.display=\"none\";\r\n    })\r\n    .finally(()=>{\r\n     \r\n    })\r\n  }\r\n\r\n  renderResult(e){\r\n    this.dataString = JSON.parse(this.querySelector(\"#dataShipping\").innerText);\r\n    for (let key in this.dataString){\r\n      this.dataString[key] = this.dataString[key].replace(\"{{code}}\" , this.zip.value);\r\n      this.dataString[key] = this.dataString[key].replace(\"{{province}}\" , this.province.value);\r\n      this.dataString[key] = this.dataString[key].replace(\"{{country}}\" , this.country.value);\r\n      key === \"many_shipping_rates\" && e.shipping_rates ? this.dataString[key] = this.dataString[key].replace(\"{{number}}\" , e.shipping_rates.length) : \"\";\r\n    }\r\n\r\n    let shippingTitle = this.dataString.not_found_shipping_rate;\r\n    if(e.shipping_rates && e.shipping_rates.length > 1){\r\n      shippingTitle = this.dataString.many_shipping_rates;\r\n    }\r\n    else if(e.shipping_rates && e.shipping_rates.length == 1){\r\n      shippingTitle = this.dataString.one_shipping_rate;\r\n    }\r\n    this.querySelector('.cartPage__resCalculate-title').innerText = shippingTitle;\r\n\r\n    let domUl = document.createElement(\"ul\");\r\n    domUl.classList.add(\"cartPage__resCalculate-listRes\");\r\n    if (e.shipping_rates){\r\n      e.shipping_rates.forEach(shipping_rate => {\r\n        let dom = document.createElement(\"li\");\r\n        dom.classList.add(\"cartPage__resCalculate-listRes-option\")\r\n        dom.innerText = `${shipping_rate.name} at $${shipping_rate.price} ${shipping_rate.currency}`\r\n        domUl.appendChild(dom);\r\n        \r\n      })\r\n    }\r\n    this.querySelector(\".cartPage__resCalculate-listRes\").replaceWith(domUl);\r\n  \r\n  }\r\n}\r\n\r\ncustomElements.define('shipping-calculator', ShippingCalculator);\r\n"],
  "mappings": "MAAA,mBAAiC,YAAY,CAC3C,aAAc,CACZ,QAEA,KAAK,IAAM,KAAK,QAAQ,IACxB,KAAK,KAAO,KAAK,cAAc,mBAC/B,KAAK,QAAU,KAAK,cAAc,mBAClC,KAAK,SAAW,KAAK,cAAc,oBACnC,KAAK,IAAM,KAAK,cAAc,eAE9B,KAAK,QAAQ,iBAAiB,SAAU,KAAK,cAAc,KAAK,OAEhE,KAAK,KAAK,iBAAiB,SAAU,KAAK,SAAS,KAAK,OACxD,KAAK,gBAEL,KAAK,WAAa,GAKpB,eAAe,CACb,GAAM,GAAW,KAAK,MAAM,KAAK,QAAQ,QAAQ,KAAK,QAAQ,eAAe,QAAQ,WAErF,KAAK,SAAS,UAAY,GAEvB,EAAS,QACV,EAAS,QAAQ,GAAM,CACrB,GAAM,GAAS,SAAS,cAAc,UACtC,EAAO,MAAQ,EAAK,GACpB,EAAO,YAAc,EAAK,GAC1B,KAAK,SAAS,sBAAsB,YAAa,KASvD,SAAS,EAAE,CACT,KAAK,cAAc,uCAAuC,MAAM,QAAQ,OACxE,KAAK,cAAc,+CAA+C,MAAM,QAAQ,QAChF,EAAE,iBACF,KAAK,UAAU,IAAI,eACnB,GAAI,GAAW,GAAI,UAAS,KAAK,MAC7B,EAAe,GAAI,iBAAgB,GAAU,WACjD,MAAM,KAAK,IAAM,IAAM,GAAc,KAAK,GAAG,EAAE,QAAQ,KAAK,GAAG,CAC7D,KAAK,aAAa,GAClB,KAAK,cAAc,uCAAuC,MAAM,QAAQ,QACxE,KAAK,cAAc,+CAA+C,MAAM,QAAQ,SAEjF,QAAQ,IAAI,IAKf,aAAa,EAAE,CACb,KAAK,WAAa,KAAK,MAAM,KAAK,cAAc,iBAAiB,WACjE,OAAS,KAAO,MAAK,WACnB,KAAK,WAAW,GAAO,KAAK,WAAW,GAAK,QAAQ,WAAa,KAAK,IAAI,OAC1E,KAAK,WAAW,GAAO,KAAK,WAAW,GAAK,QAAQ,eAAiB,KAAK,SAAS,OACnF,KAAK,WAAW,GAAO,KAAK,WAAW,GAAK,QAAQ,cAAgB,KAAK,QAAQ,OACjF,IAAQ,uBAAyB,EAAE,gBAAiB,MAAK,WAAW,GAAO,KAAK,WAAW,GAAK,QAAQ,aAAe,EAAE,eAAe,SAG1I,GAAI,GAAgB,KAAK,WAAW,wBACpC,AAAG,EAAE,gBAAkB,EAAE,eAAe,OAAS,EAC/C,EAAgB,KAAK,WAAW,oBAE1B,EAAE,gBAAkB,EAAE,eAAe,QAAU,GACrD,GAAgB,KAAK,WAAW,mBAElC,KAAK,cAAc,iCAAiC,UAAY,EAEhE,GAAI,GAAQ,SAAS,cAAc,MACnC,EAAM,UAAU,IAAI,kCAChB,EAAE,gBACJ,EAAE,eAAe,QAAQ,GAAiB,CACxC,GAAI,GAAM,SAAS,cAAc,MACjC,EAAI,UAAU,IAAI,yCAClB,EAAI,UAAY,GAAG,EAAc,YAAY,EAAc,SAAS,EAAc,WAClF,EAAM,YAAY,KAItB,KAAK,cAAc,mCAAmC,YAAY,KAKtE,eAAe,OAAO,sBAAuB",
  "names": []
}
